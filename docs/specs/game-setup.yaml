id: game-setup
title: Game Setup and Lineup Management
actor: scorekeeper
goal: create new games and configure starting lineups
outcome: ready-to-play game with proper team selection and batting order

inputs:
  - name: game_name
    type: text
    required: true
    validation: min-length-2
  - name: opponent_name
    type: text
    required: true
    validation: min-length-2
  - name: game_date
    type: date
    required: true
    validation: not-past-date
  - name: season_id
    type: select
    required: false
    source: seasons
    default: null
  - name: game_type_id
    type: select
    required: false
    source: game_types
    default: null
  - name: home_away
    type: radio
    required: true
    options: [home, away]
  - name: starting_lineup
    type: array
    required: true
    validation: min-length-9
  - name: substitutes
    type: array
    required: false
  - name: batting_position
    type: number
    required: true
    validation: range-1-15
  - name: defensive_position
    type: select
    required: true
    options:
      [
        pitcher,
        catcher,
        first-base,
        second-base,
        third-base,
        shortstop,
        left-field,
        center-field,
        right-field,
        short-fielder,
      ]

actions:
  - type: create
    label: Create Game
    target: game
  - type: select
    label: Select Team
    target: team
  - type: configure
    label: Set Lineup
    target: lineup
  - type: add
    label: Add to Lineup
    target: player
  - type: remove
    label: Remove from Lineup
    target: player
  - type: reorder
    label: Reorder Batting Order
    target: lineup
  - type: assign
    label: Assign Position
    target: player

entities:
  game:
    properties:
      - id: uuid
      - name: string
      - opponent: string
      - date: datetime
      - season_id: uuid | null
      - game_type_id: uuid | null
      - home_away: enum
      - team_id: uuid
      - status: enum [setup, in_progress, completed]
      - created_at: datetime
  lineup:
    properties:
      - id: uuid
      - game_id: uuid
      - batting_order: array<lineup_position>
      - substitutes: array<player_id>
  lineup_position:
    properties:
      - batting_order: number
      - player_id: uuid
      - defensive_position: string
      - is_starting: boolean

acceptance_criteria:
  - games can be created with essential metadata only (name, opponent, date, team)
  - games can be created with complete metadata including season and game type
  - season and game type fields are optional for quick game creation
  - teams and games can be selected from same interface
  - new games can be created quickly when needed
  - starting lineup must have 10 players minimum for slowpitch softball
  - batting order can be configured and reordered
  - defensive positions can be assigned to each player
  - substitute players can be designated
  - lineup changes are saved automatically
  - validation ensures all required positions are filled

validation_rules:
  - minimum 10 players in starting lineup for slowpitch softball
  - maximum 15 players total per game
  - batting order numbers must be unique and sequential
  - each defensive position can only be assigned once (10 positions + EP)
  - game date cannot be in the past
  - opponent name cannot be same as team name

business_rules:
  - starting lineup determines initial batting order
  - substitutes cannot be in batting order initially
  - defensive positions: P, C, 1B, 2B, 3B, SS, LF, CF, RF, SF (short fielder) for slowpitch
  - extra player (EP) bats but does not play defense
  - batting order starts at position 1
  - game setup must be completed before scoring can begin

workflows:
  game_creation:
    steps:
      - select_team
      - enter_game_details
      - configure_lineup
      - assign_positions
      - confirm_setup
  lineup_management:
    steps:
      - select_starting_players
      - set_batting_order
      - assign_defensive_positions
      - add_substitutes
      - validate_lineup

error_states:
  - name: IncompleteLineup
    http_status: 400
    response_body:
      error_code: 'LINEUP_INCOMPLETE'
      message: 'Lineup must have at least 9 batting positions and all defensive positions assigned'
  - name: InvalidBattingOrder
    http_status: 400
    response_body:
      error_code: 'BATTING_ORDER_INVALID'
      message: 'Batting order must be sequential starting from 1'
  - name: DuplicatePosition
    http_status: 400
    response_body:
      error_code: 'POSITION_DUPLICATE'
      message: 'Each defensive position can only be assigned to one player'
  - name: PlayerNotOnTeam
    http_status: 400
    response_body:
      error_code: 'PLAYER_NOT_ON_TEAM'
      message: 'Selected player is not on the chosen team'
  - name: NoPlayersAvailable
    http_status: 400
    response_body:
      error_code: 'NO_PLAYERS_AVAILABLE'
      message: 'Selected team has no active players available for lineup'

defensive_actions:
  retry_policy: 'manual-user-correction (no automatic retry for user input errors)'
  validation: 'real-time validation as user makes lineup changes'
  fallback: 'preserve partial lineup progress if modal is closed accidentally'
  error_recovery: 'highlight specific lineup issues and guide user to resolution'

component_hints:
  setup_lineup_button: "Button(leftIcon=<EditIcon />, colorScheme='blue', variant='outline', data-testid='setup-lineup-button')"
  lineup_modal: "Modal(isOpen={isOpen}, onClose={onClose}, size='xl', data-testid='lineup-setup-modal')"
  batting_order_input: "NumberInput(min={1}, max={15}, data-testid='batting-order-input')"
  position_select: "Select(placeholder='Select Position', data-testid='defensive-position-select')"
  player_select: "Select(placeholder='Select Player', data-testid='player-select')"
  start_game_button: "Button(colorScheme='green', isDisabled={!lineupComplete}, data-testid='start-game-button')"

meta:
  status: active
  version: 2.0.0
  priority: high
  dependencies: [team-management]
  created_by: breaking-bat-team
  design_spec_url: 'lineup-setup-modal-wireframe.md'
